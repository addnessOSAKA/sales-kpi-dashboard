# 営業チームKPIダッシュボード スプレッドシート連携ガイド

このガイドでは、営業チームKPIダッシュボードアプリケーションとGoogleスプレッドシートを連携する方法を説明します。

## 1. スプレッドシートの作成

### Google Apps Script（GAS）を使用してスプレッドシートを作成する

1. [Google Drive](https://drive.google.com/)にアクセスします
2. 「新規」→「その他」→「Google Apps Script」を選択します
3. プロジェクト名を「営業チームKPIダッシュボード」に変更します
4. エディタに`create_spreadsheet.gs`の内容をコピー＆ペーストします
5. 「保存」ボタンをクリックします
6. 「実行」ボタンをクリックして、`createKpiSpreadsheet`関数を実行します
7. 初回実行時は権限の承認が必要です。「承認」をクリックしてください
8. スクリプトが実行され、新しいスプレッドシートが作成されます
9. 実行ログに表示されるスプレッドシートIDとURLをメモしておきます

## 2. Google Sheets APIの有効化とAPIキーの取得

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセスします
2. プロジェクトを作成するか、既存のプロジェクトを選択します
3. 左側のメニューから「APIとサービス」→「ライブラリ」を選択します
4. 検索バーに「Google Sheets API」と入力し、検索結果から選択します
5. 「有効にする」ボタンをクリックします
6. 左側のメニューから「APIとサービス」→「認証情報」を選択します
7. 「認証情報を作成」→「APIキー」を選択します
8. 作成されたAPIキーをメモしておきます
9. （オプション）APIキーの制限を設定することをお勧めします：
   - 「APIキーを制限」をクリックします
   - 「APIの制限」で「Google Sheets API」のみを選択します
   - 「保存」をクリックします

## 3. アプリケーションの設定

1. アプリケーションの`js/config.js`ファイルを開きます
2. スプレッドシート連携設定を以下のように変更します：

```javascript
// スプレッドシート連携設定
spreadsheet: {
  enabled: true, // スプレッドシート連携を有効にする
  apiKey: 'YOUR_API_KEY', // 取得したGoogle Sheets APIキー
  id: 'YOUR_SPREADSHEET_ID', // 作成したスプレッドシートのID
  sheets: {
    weekly: 'Weekly', // 週次データのシート名
    monthly: 'Monthly', // 月次データのシート名
    members: 'Members', // 担当者データのシート名
    summary: '' // サマリーデータのシート名（空の場合は他のシートから自動生成）
  }
}
```

3. `YOUR_API_KEY`を取得したAPIキーに置き換えます
4. `YOUR_SPREADSHEET_ID`を作成したスプレッドシートのIDに置き換えます
5. 変更を保存します
6. アプリケーションを再読み込みします

## 4. スプレッドシートの共有設定

1. 作成したスプレッドシートを開きます
2. 右上の「共有」ボタンをクリックします
3. 必要に応じて、チームメンバーとスプレッドシートを共有します
4. Google Sheets APIからのアクセスを許可するために、「リンクを知っている全員」に閲覧権限を付与することをお勧めします

## 5. データの更新方法

スプレッドシートのデータを更新すると、アプリケーションに自動的に反映されます。データ更新の際は以下の点に注意してください：

1. ヘッダー行（1行目）は変更しないでください
2. 各列のデータ型を維持してください（数値は数値、テキストはテキスト）
3. 期間（period）は正確なフォーマットで入力してください（例：「2025年3月第3週」）
4. コンバージョン率や分布データなど、カンマ区切りの値は正確に入力してください

## トラブルシューティング

### データが表示されない場合

1. ブラウザのコンソールでエラーメッセージを確認します
2. APIキーとスプレッドシートIDが正しく設定されているか確認します
3. スプレッドシートの共有設定が適切か確認します
4. Google Sheets APIが有効になっているか確認します

### APIキーの制限エラーが表示される場合

1. Google Cloud Consoleで、APIキーの制限が適切に設定されているか確認します
2. リファラーの制限を設定している場合は、アプリケーションのURLが許可されているか確認します

### その他の問題

技術的な問題が解決しない場合は、開発者にお問い合わせください。 